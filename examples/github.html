<html>
    <head>
        <title>Sieve example:  GitHub</title>
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    </head>
    <body>
        <div class="jumbotron">
            <div class="container">
                <h1>Sieve example: GitHub</h1>
                <p>Visualize a user's commit dates.</p>

                <form class="form-inline" role="form">
                    <div class="form-group">
                        <input type="text" id="username" class="form-control" placeholder="Username" value="alexose">
                        <button id="go" class="btn btn-primary">Go!</button>
                    </div>
                </form>
                <div class="alert alert-danger alert-dismissable" style="display: none" id="error"></span>
            </div>
        </div>
    </body>
    <script>

(function($){
$(document).ready(function(){

var server = 'http://alexose.com:3008';

$('#go').click(function(e){
    e.preventDefault();

    // Read username from input box 
    var user = $('#username').val();

    // Basic validation
    if (!user || user.length){
        error('Please type a username.');
    }

    // Construct a Sieve request 
    var request = {
        url : "https://api.github.com/users/" + user + "/repos",
        selector : {
            name : ".name"
        },
        then : {
            url : "https://api.github.com/repos/" + user + "/sieve/commits",
            selector : {
                sha : ":has(.author .login:val(\"" + user + "\")) :root.sha"
            }
        }
    }

    // Send request to Sieve using our clever GET technique
    var str = btoa(JSON.stringify(request));
    $.getJSON(server + '?callback=?', str, finish);

    // Do something with response
    function finish(data){
        console.log(data);
    }
});

// Bootstrappy error handler
var timeout;
function error(message){

    var el = $('#error');

    el
        .text(message)
        .fadeIn();

    if (timeout){
        clearTimeout(timeout);
    }

    var timeout = setTimeout(function(){
        el.fadeOut();
    }, 6000);
}

});
})(jQuery);


    </script>
</html>
